stages:
 - build

coda_build_image:
  stage: build
  image:
    name: gcr.io/kaniko-project/executor:v1.23.2-debug
    entrypoint: [""]
  variables:
    IMAGE: coda-build
  script:
    - /kaniko/executor
      --context $CI_PROJECT_DIR/coda-build
      --dockerfile $CI_PROJECT_DIR/coda-build/Dockerfile
      --destination ${CI_REGISTRY_IMAGE}/${IMAGE}
      --cache=true
      --cache-copy-layers=true
      --cache-ttl=24h
  only:
    changes:
      - .gitlab-ci.yml
      - coda-build/*
